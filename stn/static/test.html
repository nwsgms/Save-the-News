<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8"/>
    <script type="text/javascript" src="js/log.js"></script>
    <script type="text/javascript" src="js/canvas.text.js"></script>
    <script type="text/javascript" src="js/jquery-1.5.1.js"></script>
    <script type="text/javascript" src="js/underscore.js"></script>
    <script type="text/javascript" src="js/backbone.js"></script>
    <script type="text/javascript" src="js/ui/jquery.ui.core.js"></script>
    <script type="text/javascript" src="js/ui/jquery.ui.widget.js"></script>
    <script type="text/javascript" src="js/ui/jquery.ui.mouse.js"></script>
    <script type="text/javascript" src="js/ui/jquery.ui.draggable.js"></script>
    <script type="text/javascript" src="js/ui/jquery.effects.core.js"></script>
    <script type="text/javascript" src="js/ui/jquery.effects.fade.js"></script>
    <script type="text/javascript" src="js/resources.js"></script>
    <script type="text/javascript" src="js/rect.js"></script>
    <script type="text/javascript" src="js/sprintf.js"></script>
    <script type="text/javascript" src="js/string.js"></script>
    <script type="text/javascript" src="js/text_renderer.js"></script>
    <script type="text/javascript" src="js/time_display.js"></script>
    <script type="text/javascript" src="js/messages.js"></script>
    <script type="text/javascript" src="js/news_item.js"></script>
    <script type="text/javascript" src="js/base.js"></script>
    <script type="text/javascript" src="js/sorting.js"></script>
    <script type="text/javascript" src="js/image_sorting.js"></script>
    <script type="text/javascript" src="js/animation.js"></script>
    <script type="text/javascript" src="js/game.js"></script>
    <script type="text/javascript" src="js/start.js"></script>
    <script type="text/javascript" src="js/loader.js"></script>
    <link rel="stylesheet" href="css/test.css" type="text/css" media="all" ></script>
    <title>Save the News</title>
  </head>
  <body>
    <h1>Save the news</h1>
    <!--canvas id="arena" width="960" height="480"></canvas-->
    <canvas id="arena" width="480" height="320"></canvas>

    <script type="text/javascript">
      $(function() {
      var canvas = $("#arena").get(0);
      window.game = new LoadScreen(
      canvas, 30.0, canvas.width / 960.0,
        function() {
           window.game = new ImageSortingGame(
               new TimerDisplay(60.0),
               canvas, 30.0, canvas.width / 960.0);
           get_messages(
              function(messages) {
                  var count = _.size(messages);
                  function cb(message) {
                     count--;
                     if(count == 0) {
                        window.game.set_messages(messages);
                        window.game.start();
                        console.log("started game");
                     } else {
                        messages[count-1].load_images("iPhone3", cb);
                     }
                  }
                  messages[count-1].load_images("iPhone3", cb);
              }
           );
           
        }
      ); 
      window.game.debug = true;
      window.game.start();
      function mousedown(event) {
         game.mousedown(event);
      };
      function mousemove(event) {
         if(game.mousemove !== undefined) {
            game.mousemove(event);
         }
      };
      function mouseup(event) {
         if(game.mouseup !== undefined) {
            game.mouseup(event);
         }
      };
      $(canvas).mousedown(mousedown).mousemove(mousemove).mouseup(mouseup);
      });      
    </script>
  </body>
</html>
      
